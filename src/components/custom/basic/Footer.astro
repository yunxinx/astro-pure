---
import config from 'virtual:config'

import siteConfig from '@/site-config'

import { Icon } from 'astro-pure/user'

const footerConf = config.footer
let social = footerConf.social || {}

// If the list does not contain rss, add it
if (!social.rss)
  social.rss = {
    label: 'RSS',
    url: '/rss.xml'
  }

// pos=1 的链接（备案链接）
const footerLinks = ((siteConfig as any)?.footer?.links ?? footerConf.links ?? []) as Array<{
  title: string
  link: string
  style?: string
  pos?: number
  icon?: string
}>
const footerLink1 = footerLinks.filter(({ pos }) => (pos ?? 1) === 1) || []
// pos=2 的链接（追加到版权行）
const footerLink2 = footerLinks.filter(({ pos }) => (pos ?? 1) === 2) || []
---

<footer class='mx-auto mb-5 mt-16 w-full'>
  <div class='border-t pt-5'>
    {/* 桌面端布局 */}
    <div class='hidden sm:flex items-center justify-between'>
      <div class='flex items-center gap-x-1 text-muted-foreground footer-text'>
        {/* 版权部分 */}
        <span class='footer-copyright'>
          {config.footer.year} {config.author}
          {footerLink2.length > 0 && (
            <>
              &nbsp;&amp;&nbsp;
              {footerLink2.map(({ title, link, style }) => (
                <a href={link} target='_blank' class={style}>{title}</a>
              ))}
            </>
          )}
        </span>
        {/* 分隔符 */}
        {footerLink1.length > 0 && <span class='mx-2'>|</span>}
        {/* 备案链接 */}
        {footerLink1.map(({ title, link, style, icon }, index) => (
          <>
              {icon && <img src={icon} alt='公安图标' width="34" height="40" decoding="async" loading='lazy' class='inline-block mr-0.5 w-[12px]' />}
            <a href={link} target='_blank' class={style}>{title}</a>
            {index < footerLink1.length - 1 && <span class='mx-1'>•</span>}
          </>
        ))}
      </div>

      {/* 社交图标 */}
      <div class='flex items-center gap-x-4'>
        {footerConf.social &&
          Object.entries(footerConf.social).map(([platform, { label, url }]) => (
            <a href={url} aria-label={label}>
              <Icon name={platform as keyof typeof footerConf.social} />
            </a>
          ))}
      </div>
    </div>

    {/* 移动端布局 */}
    <div class='flex flex-col items-center gap-y-2 sm:hidden text-muted-foreground footer-text'>
      {/* 版权行 */}
      <div class='footer-copyright'>
        {config.footer.year} {config.author}
        {footerLink2.length > 0 && (
          <>
            &nbsp;&amp;&nbsp;
            {footerLink2.map(({ title, link, style }) => (
              <a href={link} target='_blank' class={style}>{title}</a>
            ))}
          </>
        )}
      </div>
      {/* 备案链接行 */}
      {footerLink1.length > 0 && (
        <div class='flex items-center'>
          {footerLink1.map(({ title, link, style, icon }, index) => (
            <>
              {icon && <img src={icon} alt='' loading='lazy' class='inline-block mr-0.5 h-[13px] w-[12px]' />}
              <a href={link} target='_blank' class={style}>{title}</a>
              {index < footerLink1.length - 1 && <span class='mx-2'>|</span>}
            </>
          ))}
        </div>
      )}
      {/* 社交图标 */}
      <div class='flex items-center gap-x-4 mt-1'>
        {footerConf.social &&
          Object.entries(footerConf.social).map(([platform, { label, url }]) => (
            <a href={url} aria-label={label}>
              <Icon name={platform as keyof typeof footerConf.social} />
            </a>
          ))}
      </div>
    </div>
  </div>
</footer>

<style>
  footer a {
    color: hsl(var(--foreground) / var(--un-text-opacity, 1));
    text-decoration: none;
    font-weight: 500;
  }
  .footer-text {
    font-size: 12px;
  }
  .footer-copyright {
    font-size: 13px;
  }
</style>
